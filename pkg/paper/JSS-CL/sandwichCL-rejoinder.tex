\documentclass[10pt,a4paper]{article}

\usepackage[flushleft]{threeparttable}
\usepackage[latin1]{inputenc}
\usepackage{a4wide,graphicx,color,thumbpdf}
\usepackage{hyperref}

\setlength{\parskip}{0.7ex plus0.1ex minus0.1ex}
\setlength{\parindent}{0em}

\begin{document}

\title{Point-to-point reply}
\author{Various Versatile Variances:\\ An Object-Oriented Implementation of Clustered Covariances in R}
\date{}
\maketitle

\section*{Associate Editor}

\textbf{\textit{Both reviewers find the paper acceptable for publication in the JSS, but
have suggestions for revisions.}}

\medskip

We thank both reviewers for their positive comments about the manuscript. Both made important contributions to further improve the manuscript.
 
\medskip  

\textbf{\textit{In particular, Reviewer A points to some additional references that appear
to be relevant to the paper, while reviewer B points to some unclear (and
possibly incorrect) equations and passages in the paper.}}

\medskip

Indeed, the mentioned additional references are relevant to the paper. The seminal paper by Liang and Zeger (1986) now attracts more attention in the historical overview. 
A discussion of the very recent paper by Abadie et al. (2017), which we were not aware of, is now also included. 
Proposals regarding unclear and incorrect equation and passages, especially in Sections~3.3 and 4.4, have been undertaken a thorough revision. 

\medskip 

\textbf{\textit{With respect to the reviewers' comments, Reviewer A states near the end of
the review that, ``I think the authors should make readers aware of
bootstrap-type alternatives to the analytical cluster-robust covariance
estimators (the 'wild bootstrap' etc.).'' In fact, in the simulations
reported in the paper, there is a comparison to the bootstrap (though
limited to the simple cluster-resampling bootstrap).}}

\medskip

Thank you for pointing this out. Yes, this is indeed an important comparison and
in the previous version we just included a simple clustered bootstrap covariance
as a reference in the simulation. Now the manuscript provides some more background
for bootstrap covariances as well as a brief introduction to the \texttt{vcovBS()}
generic function included in the package (see Section~4.4).

In addition to the default \texttt{vcovBS()} method that computes simple (clustered)
pair (or ``xy'') bootstrap covariances, there is now a dedicated method for \texttt{"lm"}
objects. The latter includes also residual-based bootstrap and wild bootstrap variants
which are -- to the best of our knowledge -- confined to the linear regression case.
Therefore, we do not go into more detail about this function/method because the manuscript's
focus is the object-oriented toolbox for clustered covariances.

\medskip

\textbf{\textit{As well, I didn't find the material raised in Reviewer B's points 1, 6, 11,
and 14 to be unclear, although it wouldn't hurt to provide a bit more
explanation in these places.}}

\medskip

We agree that making the manuscript more accessible for readers with different backgrounds is
clearly desirable and we have tried to embellish the text following Reviewer B's advice.
For details see below.

\medskip

\textbf{\textit{My own reading of the paper is largely consistent with the reviewers', and
I'd add that the paper and the improvements and extensions to the sandwich
package that it describes are an important contribution, both elegant in its
implementation and of substantial practical use.}}

\medskip

Thank you very much, your feedback and that from the reviewers is much appreciated
and has further improved manuscript and software.

\medskip

\textbf{\textit{I found the simulations reported in section 6 slightly inappropriate to the
main purpose of the paper, which is to describe the implementation in the
sandwich package of coefficient-covariance estimators for clustered data. 
The simulations are a contribution to the more general statistical
literature on sandwich estimators and are probably more naturally published
independently.  That said, I don't strongly object to the inclusion of this
section in the paper.}}

\medskip

We agree that the simulations do not fall within the narrower scope of the manuscript/software.
However, the object-oriented software enabled us to explore the questions covered in the
simulation. And as we were not aware of such empirical comparisons for models beyond
linear regression we felt that some guidance about the covariances' properties was useful
for the readers and ourselves. Hence, we decided to keep the simulations in the manuscript.

\medskip

\textbf{\textit{I also found a few typos in the manuscript: At several points in the paper,
e.g., on p.~7, ``subtract'' and ``subtracted'' are spelled ``substract'' and
``substracted.'' On p.~9, ``and and'' appears (the second ``and'' in italics). 
On p.~14, ``sandwich covariance are able'' should read ``sandwich covariances
are able.''}}

\medskip

Thank you for spotting these: fixed now.


\bigskip

\section*{Referee 1}

\textbf{\textit{Comparison with Stata (as requested by the editor):
\\ \\
The comparison with Stata naturally separates into two parts: ``Official Stata'', i.e., the code provided by StataCorp when purchasing the software, and ``the Stata Community'', i.e., code provided by the user community at large and (mostly) residing at SSC Archives.
\\ \\
Official Stata has supported basic ``cluster-robust'' covariance estimation for many of its estimators for many years (since the 90s, I think).  It also supports ``panel corrected SE'' (Beck and Katz 1995) for some panel data estimators.  Cluster-robust support in Official Stata is extensive in terms of estimators, but basic in terms of various options available.  Only one-way clustering is supported, and the range of alternative finite-sample adjustments that is available in Stata for standard robust covariance estimation is not also available for cluster-robust covariance estimation.  Driscoll-Kraay and panel Newey-West time covariance estimation is not supported in Official Stata.
\\ \\
Official Stata also supports a cluster-robust-type solution to covariance estimation for multiple-equation estimation via its ``suest'' command.
\\ \\
Probably the Stata Community package closest to what is documented in this paper is avar (``Asymptotic covariance estimation for iid and non-iid data robust to heteroskedasticity, autocorrelation, 1- and 2-way clustering, common cross-panel autocorrelated disturbances, etc.'') by Baum and Schaffer (2013).  The main differences between avar and the package documented in the paper: (1) avar provides only the ``filling'' (``meat'') matrix; it is up to the user/programmer to assemble the sandwich; (2) VVV supports various options and estimators not provided by avar: Beck \& Katz panel-corrected SEs; a range of finite-sample adjustments to the cluster-robust covariance estimator; 3-way and higher clustering; (3) avar supports multiple-equation estimation as well as Kiefer's (1980) covariance estimator for panel data (Journal of Econometrics, 14:2).}}

\medskip

Thank you for the detailed explanation of the different types of clustered covariances in official as well as in user-written Stata.
With regard to the reproducibility of results in different software packages, the comparison with Stata is very valueable and definitely deserves some attention.
Hence, the manuscript now contains a new Section~2.5 with a discussion of various types of clustered covariances in Stata, strongly aligned to the thorough discussion of the reviewer.

\medskip

\textbf{\textit{Suggestions for the authors:
\\ \\
My suggestions come in two parts: (1) suggestions relating to the writeup; (2) suggestions relating to the software.
\\ \\
Suggestions relating to the writeup:
\\ \\
The writeup is fine as it is, but I think readers and users would benefit a lot from expanding the discussion to cover the limitations of, alternatives to, and history of the cluster-robust covariance estimation.
}}

\medskip

We agree that the properties of clustered covariances with respect to its limitations should be discussed in the manuscript, as well as the development of clustered covariances in history.
A new Section~2.2 covers the history and properties of clustered covariances, giving emphasis to the limitations of the methods.

As already pointed out in the response to the Associate Editor, Section~4.4 has been added to
briefly discuss bootstrap covariances as an alternative to sandwich estimators. 

\medskip

\textbf{\textit{A very recent paper by Abadie-Athey-Imbens-Wooldridge (October 2017), ``When Should You Adjust Standard Errors for Clustering?'', https://arxiv.org/abs/1710.02926, is very helpful in this respect.  The paper results are too lengthy to summarize here; I will say only that the main point that is relevant for the VVV paper is that the assumption of parameter homogeneity (identical treatment effects across units) is central for many of the standard results for the cluster-robust covariance estimator.  I think the VVV authors should have a look and briefly summarize what they think are the main lessons for the potential users of their package.
}}

\medskip

Thank you for pointing out to the Abadie et al. (2017) paper. It does include several results that are important for users of clustered covariances. 
A discussion of some aspects of Abadie et al. (2017) is now incorporated in the manuscript in Section~2.2, especially pointing to economic experiments where the sampling process or the assignment mechanism exhibits a systematic variation within clusters thereby justifies the use of clustered covariances.


\medskip

\textbf{\textit{Also worth noting is the history of the cluster-robust estimator: AAIH refer to it as the Liang-Zeger (1986 Biometrika) covariance estimator.  This is probably worth doing in the VVV paper as well, unless the authors have an earlier source for this estimator.
}}

\medskip

We decided to keep the naming ``clustered covariance estimator'' for two reasons:
First, the name is widely used in the literature.
Second, the GEE framework of Liang and Zeger (1986) indeed encompasses the independence
working model along the corresponding clustered covariances. However, it naturally extends
to other correlation structures (most importantly, exchangeable and AR1) for which not
only the covariances are adjusted but also the coefficient estimates themselves. Therefore,
we feel that some readers may be confused by referring to ``Liang-Zeger'' as they might
expect that the parameters are estimated by GEEs.

\medskip

\textbf{\textit{On page 6 the authors state that ``the number of clusters G must approach infinity'', but strictly speaking this is not the case: there are papers that have explored the behavior of the cluster-robust covariance estimator as the number of observations goes to infinity but holding constant the number of clusters (``infilling asymptotics'').  A good paper here is Bester-Conley-Hansen (2011), ``Inference with Dependent Data Using Cluster Covariance Estimators'', 165:2.
}}

\medskip

Thanks for the note, we agree that the formulation requires some reformulation and additional comments. Clustered covariance estimators in sandwich are based on the frequently used ``large $G$'' approach. As pointed out by the referee, other approaches are available. The ``fixed-G'' setup can alternatively be employed, but requires non-normal inference and can thus not be combined with standard tests in the same modular way as implemented in sandwich which is the reason why it is not pursued further in the manuscript.

\medskip

\textbf{\textit{Lastly, I think the authors should make readers aware of bootstrap-type alternatives to the analytical cluster-robust covariance estimators (the ``wild bootstrap'' etc.).}}

\medskip

Thank you for making this point. For a detailed answer we kindly refer to the reply for the Associate Editor. 

\medskip

\textbf{\textit{Suggestions relating to the code:
\\
The authors may want to consider incorporating the  covariance estimator of Kloek (1981, Econometrica; see the AAIW paper for a description and discussion) and/or Kiefer (1980).}}

\medskip

Kiefer (1980) investigates fixed effects panel models extended to cases of intertemporal correlations, where coefficients and standard errors are estimated by GLS. As the \texttt{sandwich} package has been designed as an object-oriented toolbox that does not modify the parameter estimators, this covariance estimator does not fit well into the package. Instead, it would be more natural to include it in the \texttt{plm} package for panel linear models that also provides  a function \texttt{pggls()} for generalized FGLS with (or without) fixed effects. We raised the issue with Giovanni Millo, author of the variance-covariance estimators in \texttt{plm}, and he agreed that this would be a useful addition to \texttt{plm} and included Kiefer-type covariances in the to-do list for the package. It is worth noting that the Stata module \texttt{avar} provides some generalized implementation of the classic Kiefer (1980) estimator that is also applicable beyond FGLS. However, so far, neither Giovanni nor us succeeded in exactly replicating this generalization.

Similar arguments hold for the Kloek-type convariances: As they have been developed for specific linear models they would better match the scope of \texttt{plm} rather than \texttt{sandwich}. Hence, we decided not to implement these covariances.

\bigskip

\section*{Referee 2}

\textbf{\textit{1. In equation (2), the definition of the term ``$\psi'(y, x, \theta)$'' unclear.
I guess that this term should indicate $\partial \psi(y, x, \theta)/\partial\theta = \partial^2\Psi(y, x, \theta)/\partial\theta^2$ and I recommend to replace ``$\psi'(y, x, \theta)$''
by an expression that readers can easily understand
(e.g., ``$\partial \psi(y, x, \theta)/\partial\theta$'' or ``$\partial^2\Psi(y, x, \theta)/\partial\theta^2$").}}

\medskip

Term $\psi(y, x, \theta)$ is meant to be the first derivative of an objective function $\Psi(y, x, \theta)$ (typically the log-likelihood), with respect to a parameter vector $\theta$. As mentioned correctly by the referee, $\psi'(y, x, \theta)$ is the second derivative of the objective function $\Psi(y, x, \theta)$ with respect to $\theta$.

The term $\psi'(y, x, \theta)$ has been replaced by $\frac{\partial \psi(y, x, \theta)}{\partial\theta}$ in Equation~2 as well as in Equation~6.

\medskip

\textbf{\textit{2. The matrix defined in equation (5) is slightly unclear. I guess that the terms ``$\psi(y_i, x_i, \hat\theta)$'' ($i \in \{1, n\}$) in equation (5) indicate row-vectors. As vectors are usually assumed to be column-vectors (unless stated otherwise) and $\psi(y_i, x_i, \hat\theta)$ seem to be column-vectors in
equation (7), I recommend to add transformation signs to the two vectors in equation (5)
so that they become ``$\psi(y_i, x_i, \hat\theta)^\top$''.}}

\medskip

According to the proposal, transformation signs have been added in Equation~5 as well as in Equation~11. 

\medskip

\textbf{\textit{3. It seems to me that equation (12) is incorrect, because this equation is basically identical
to equation (7) and, thus, does not take into account clustering (as it simply takes the
sum over all observations). I guess that the correct equation is something like:
\begin{equation}
  \hat M_\mathrm{CL} \quad = \quad \frac{1}{n} \sum_{g = 1}^G\bigg(\sum_{i = 1}^{n_{g}}\psi(y_{ig}, x_{ig}, \hat \theta) \bigg) \bigg(\sum_{i = 1}^{n_{g}} \psi(y_{ig}, x_{ig}, \hat \theta) \bigg)^\top.
\end{equation}}}

\medskip

Thank you for having stressed this, the equation has been corrected. 

\medskip

\textbf{\textit{4. The ``hat matrix H'' that is mentioned on page 6 is not defined in the manuscript. I
recommend that the authors define this matrix in the manuscript.}}

\medskip

Thank you for pointing this out. The definition of the hat matrix $H$ has been included in the manuscript for the linear model.
A generalization of the hat matrix is also available for generalized linear models, though we refrained to propose a thorough definition.

\medskip

\textbf{\textit{5. On page 7, several parts in the paragraph that starts with ``Petersen (2009)'' are unclear
to me. I recommend that the authors reformulate and perhaps extend this paragraph in
order to make it easier understandable.}}

\medskip

The paragraph has been reformulated and is now hopefully easier to understand. In fact, Equation (20) lacked the needed cluster bias corrections for the meat matrices, which are now added. Perhaps this caused the confusion in this paragraph.

\medskip

\textbf{\textit{6. It is not clear to me which of the approaches that are described in sections 3.3 and 3.4
of the manuscript (and that are implemented in the sandwich package) can deal with clustering of individuals in panel data sets, e.g., if the panel data set includes data from T time periods for n individuals that are ``clustered'' in G groups of individuals. Please clarify this in the manuscript.}}

\medskip

\textbf{\textit{7. In equation (21), it is unclear to me how this approach takes into account the time
dimension of the panel data set (as none of the terms in this equation has a subscript t).
Furthermore, as subscripts i and j seem to indicate individuals (or observations?), it
seems to be weird that the ordering of the individuals (or of the observations) affects the
weights that account for ``correlation'' between each pair of individuals (or observations).
Please clarify this in the manuscript.}}

\medskip

\textbf{\textit{8. In equation (22), similarly to equation (21), it seems to be weird that the ordering of
the individuals affects the weights that account for ``correlation'' between each pair of
individuals. Please clarify this in the manuscript.}}

\medskip

\textbf{\textit{9. In section 3.4, the use of subscripts for individuals, groups, and time periods is confusing
and perhaps inconsistent. I recommend that the authors considerably revise and extend
this section so that it is less confusing and easier to understand.}}

\medskip

 Points 6.~to 9.: To reflect that the data are now panel data with a natural time ordering within each entity $g$ labelled \emph{groups} (without a natural ordering, as for example individuals, countries, firms, \ldots) according to Millo (2014), we change our notation
to an index $(g, t)$ for $g = 1, \dots, G$ observations sampled at $t = 1, \ldots, n_g$ points in \emph{time} (with $n = n_1 + \dots + n_G$).

However, expressions like \emph{groups} and \emph{time} are convenience terms and are used for concreteness to make the concepts more easily comprehensible. Clustered covariances for paned data account for the average within-cluster covariance, where a cluster is any set of observations with can be identified by a variable to ``cluster on''. 

Regarding the notation, an index $t$ is introduced to make the time dimension more visible.

\medskip

\textbf{\textit{10. On page 11, the closing parenthesis behind ``"NW1994"'' needs to be removed.}}

\medskip

The paranthesis has been removed.

\medskip

\textbf{\textit{11. Equation (25) seems to be inconsistent with equations (29) and (30), because $\beta_1$ and
$\beta_2$ seem to be scalars in equation (25), while they seem to be vectors in equations (29)
and (30). This needs either to be corrected or -- if it is correct -- more clearly explained.}}

\medskip

Thank you for pointing that out. The error has been corrected.

\medskip

\textbf{\textit{12. In Figures 1 and 2, the symbols for ``standard'' and ``basic'' (red and pink triangles)
as well as the symbols for ``random'' and ``gee'' (violet and red plus signs) look very
similar and cannot be easily distinguished from each other. I recommend to use clearly
different symbols (e.g., dark red triangle, orange up-side-down triangle, black plus sign,
grey asterisk).}}

\medskip

We have changed the colors as well as symbols in Figures~1 to 3 according to the reviewers recommendation and hope to provide a better differentiability of the curves.

\medskip

\textbf{\textit{13. In the captions of Figures 1, 2, and 3, the meaning of the symbol ``$\rho$'' is unclear. Are
there typos and the ``$\rho$''s should be in fact ``$\rho_x$''s or do the ``$\rho$''s indicate something else?
This needs to be correct or explained.}}

\medskip

The cluster correlation of the regressors is controlled by parameter $\rho_x$. Note that the previously introduced cluster correlation of the response distribution is determined by yet another parameter $\rho$. Both $\rho$ and $\rho_x$ can affect the coverage of the methods investigated. In the simulations, $\rho_x$ is fixed to 0.25, such that the corresponding regressor $x1$ is correlated, and in between the effects of the clustered regressor $x2$ with $\rho_x = 1$, and the uncorrelated regressor $x3$, where $\rho_x = 0$.

\medskip

\textbf{\textit{14. Several parts of the manuscript are not easily comprehensible for people who have limited
prior knowledge about ``sandwich'' methods and clustering in general. I highly recommend
that the authors revise and extend their explanations so that the manuscript can be more
easily understood by practitioners who want to apply the methods that are described in
the manuscript and are implemented in the sandwich package.}}

\medskip

We hope that the revision of the manuscript makes it more understandable to the reader.
With respect to the notation, a time index $t$ is introduced in Section~3.2, pointing closer to the time dimension of clustered covariances for panel data.  
As already mentioned, we also tried to highlight that expressions like \emph{groups} and \emph{time} are convenience terms that are used to make the concepts more easily comprehensible, and that a group in the panel data context is any set of observations with can be identified by a variable to ``cluster on''. 

\end{document}
