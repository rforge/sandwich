<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Clustered Covariance Matrix Estimation for Panel Data — vcovPL • sandwich</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  

<meta property="og:title" content="Clustered Covariance Matrix Estimation for Panel Data — vcovPL" />
<meta property="og:description" content="Estimation of sandwich covariances a la Newey-West (1987)
  and Driscoll and Kraay (1998) for panel data." />
<meta property="og:image" content="https://sandwich.R-Forge.R-project.org/logo.png" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:creator" content="@AchimZeileis" />
<meta name="twitter:site" content="@AchimZeileis" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sandwich</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.0-1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/sandwich.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/jss_2004.html">Econometric Computing with HC and HAC Covariance Matrix Estimators</a>
    </li>
    <li>
      <a href="../articles/jss_2006.html">Object-Oriented Computation of Sandwich Estimators</a>
    </li>
    <li>
      <a href="../articles/jss_2020.html">Various Versatile Variances: An Object-Oriented Implementation of Clustered Covariances in R</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="../contact.html">Contact</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Clustered Covariance Matrix Estimation for Panel Data</h1>
    
    <div class="hidden name"><code>vcovPL.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Estimation of sandwich covariances a la Newey-West (1987)
  and Driscoll and Kraay (1998) for panel data.</p>
    </div>

    <pre class="usage"><span class='fu'>vcovPL</span>(<span class='kw'>x</span>, cluster = <span class='kw'>NULL</span>, order.by = <span class='kw'>NULL</span>,
  kernel = <span class='st'>"Bartlett"</span>, sandwich = <span class='fl'>TRUE</span>, fix = <span class='fl'>FALSE</span>, <span class='kw'>...</span>)

<span class='fu'>meatPL</span>(<span class='kw'>x</span>, cluster = <span class='kw'>NULL</span>, order.by = <span class='kw'>NULL</span>,
  kernel = <span class='st'>"Bartlett"</span>, lag = <span class='st'>"NW1987"</span>, bw = <span class='kw'>NULL</span>,
  adjust = <span class='fl'>TRUE</span>, <span class='kw'>...</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>a fitted model object.</p></td>
    </tr>
    <tr>
      <th>cluster</th>
      <td><p>a variable indicating the clustering of observations,
    a <code>list</code> (or <code>data.frame</code>) thereof, or a formula specifying
    which variables from the fitted model should be used (see examples).
    By default (<code>cluster = NULL</code>), either <code><a href='https://rdrr.io/r/base/attr.html'>attr(x, "cluster")</a></code> is used
    (if any) or otherwise every observation is assumed to be its own cluster.</p></td>
    </tr>
    <tr>
      <th>order.by</th>
      <td><p>a variable, list/data.frame, or formula indicating the
    aggregation within time periods. By default <code><a href='https://rdrr.io/r/base/attr.html'>attr(x, "order.by")</a></code> is used
    (if any) or otherwise observations within clusters are assumed to be ordered.</p></td>
    </tr>
    <tr>
      <th>kernel</th>
      <td><p>a character specifying the kernel used. All kernels
    described in Andrews (1991) are supported, see <code><a href='kweights.html'>kweights</a></code>.</p></td>
    </tr>
    <tr>
      <th>lag</th>
      <td><p>character or numeric, indicating the lag length used.
    Three rules of thumb (<code>"max"</code> or equivalently <code>"P2009"</code>,
    <code>"NW1987"</code>, or <code>"NW1994"</code>) can be specified, or a numeric
    number of lags can be specified directly. By default, <code>"NW1987"</code> is used.</p></td>
    </tr>
    <tr>
      <th>bw</th>
      <td><p>numeric. The bandwidth of the kernel which by default corresponds
    to <code>lag + 1</code>. Only one of <code>lag</code> and <code>bw</code> should be
    used.</p></td>
    </tr>
    <tr>
      <th>sandwich</th>
      <td><p>logical. Should the sandwich estimator be computed?
    If set to <code>FALSE</code> only the meat matrix is returned.</p></td>
    </tr>
    <tr>
      <th>fix</th>
      <td><p>logical. Should the covariance matrix be fixed to be
    positive semi-definite in case it is not?</p></td>
    </tr>
    <tr>
      <th>adjust</th>
      <td><p>logical. Should a finite sample adjustment be made? This
    amounts to multiplication with \(n/(n - k)\) where \(n\) is the
    number of observations and \(k\) is the number of estimated parameters.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>arguments passed to the <code>metaPL</code> or <code>estfun</code> function,
    respectively.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>vcovPL</code> is a function for estimating the Newey-West (1987) and
  Driscoll and Kraay (1998) covariance matrix.
  Driscoll and Kraay (1998) apply a Newey-West type correction to the
  sequence of cross-sectional averages of the moment conditions (see
  Hoechle (2007)). For large \(T\) (and regardless of the length of the
  cross-sectional dimension), the Driscoll and Kraay (1998)
  standard errors are robust to general forms of cross-sectional and
  serial correlation (Hoechle (2007)).
  The Newey-West (1978) covariance matrix restricts the Driscoll and
  Kraay (1998) covariance matrix to no cross-sectional correlation.</p>  
<p>The function <code>meatPL</code> is the work horse for estimating
  the meat of Newey-West (1978) and Driscoll and Kraay (1998)
  covariance matrix estimators. <code>vcovPL</code> is a wrapper calling
  <code><a href='sandwich.html'>sandwich</a></code> and <code><a href='bread.html'>bread</a></code> (Zeileis 2006).</p>
<p>Default lag length is the <code>"NW1987"</code>. 
  For <code>lag = "NW1987"</code>, the lag length is chosen from the heuristic
  \(floor[T^{(1/4)}]\). More details on lag length selection in Hoechle (2007). 
  For <code>lag = "NW1994"</code>, the lag length is taken from the first step
  of Newey and West's (1994) plug-in procedure.</p>  
<p>The <code>cluster</code>/<code>order.by</code> specification can be made in a number of ways:
  Either both can be a single variable or <code>cluster</code> can be a 
  <code>list</code>/<code>data.frame</code> of two variables.
  If <code><a href='https://rdrr.io/r/stats/expand.model.frame.html'>expand.model.frame</a></code> works for the model object <code>x</code>,
  the <code>cluster</code> (and potentially additionally <code>order.by</code>) can also be
  a <code>formula</code>. By default (<code>cluster = NULL, order.by = NULL</code>),
  <code><a href='https://rdrr.io/r/base/attr.html'>attr(x, "cluster")</a></code> and <code><a href='https://rdrr.io/r/base/attr.html'>attr(x, "order.by")</a></code> are checked and
  used if available. If not, every observation is assumed to be its own cluster,
  and observations within clusters are assumed to be ordered accordingly.
  If the number of observations in the model <code>x</code> is smaller than in the
  original <code>data</code> due to <code>NA</code> processing, then the same <code>NA</code> processing
  can be applied to <code>cluster</code> if necessary (and <code>x$na.action</code> being
  available).</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A matrix containing the covariance matrix estimate.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Andrews DWK (1991).
  &#8220;Heteroscedasticity and Autocorrelation Consistent Covariance Matrix Estimation&#8221;,
  <em>Econometrica</em>, 817--858.</p>
<p>Driscoll JC &amp;  Kraay AC (1998).
  &#8220;Consistent Covariance Matrix Estimation with Spatially Dependent Panel Data&#8221;,
  <em>The Review of Economics and Statistics</em>, <b>80</b>(4), 549--560.</p>
<p>Hoechle D (2007).
  &#8220;Robust Standard Errors for Panel Regressions with Cross-Sectional Dependence&#8221;,
  <em>Stata Journal</em>, <b>7</b>(3), 281--312.</p>
<p>Newey WK &amp; West KD (1987).
  &#8220;Hypothesis Testing with Efficient Method of Moments Estimation&#8221;,
  <em>International Economic Review</em>, 777-787.</p>
<p>Newey WK &amp; West KD (1994).
  &#8220;Automatic Lag Selection in Covariance Matrix Estimation&#8221;,
  <em>The Review of Economic Studies</em>, <b>61</b>(4), 631--653.</p>  
<p>White H (1980).
  &#8220;A Heteroskedasticity-Consistent Covariance Matrix Estimator and a Direct Test for Heteroskedasticity&#8221;,
  <em>Econometrica</em>, 817--838.
  doi: <a href='https://doi.org/10.2307/1912934'>10.2307/1912934</a></p>  
<p>Zeileis A (2004).
  &#8220;Econometric Computing with HC and HAC Covariance Matrix Estimator&#8221;,
  <em>Journal of Statistical Software</em>, <b>11</b>(10), 1--17.
  doi: <a href='https://doi.org/10.18637/jss.v011.i10'>10.18637/jss.v011.i10</a></p>
<p>Zeileis A (2006).
  &#8220;Object-Oriented Computation of Sandwich Estimators&#8221;,
  <em>Journal of Statistical Software</em>, <b>16</b>(9), 1--16.
  doi: <a href='https://doi.org/10.18637/jss.v016.i09'>10.18637/jss.v016.i09</a></p>
<p>Zeileis A, Köll S, Graham N (2020).
  &#8220;Various Versatile Variances: An Object-Oriented Implementation of Clustered Covariances in R.&#8221;
  <em>Journal of Statistical Software</em>, <b>95</b>(1), 1--36.
  doi: <a href='https://doi.org/10.18637/jss.v095.i01'>10.18637/jss.v095.i01</a></p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='vcovCL.html'>vcovCL</a></code>, <code><a href='vcovPC.html'>vcovPC</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## Petersen's data</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"PetersenCL"</span>, package = <span class='st'>"sandwich"</span>)
<span class='kw'>m</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span>(<span class='kw'>y</span> <span class='op'>~</span> <span class='kw'>x</span>, data = <span class='kw'>PetersenCL</span>)

<span class='co'>## Driscoll and Kraay standard errors</span>
<span class='co'>## lag length set to: T - 1 (maximum lag length)</span>
<span class='co'>## as proposed by Petersen (2009)</span>
<span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span>(<span class='fu'>vcovPL</span>(<span class='kw'>m</span>, cluster = <span class='op'>~</span> <span class='kw'>firm</span> <span class='op'>+</span> <span class='kw'>year</span>, lag = <span class='st'>"max"</span>, adjust = <span class='fl'>FALSE</span>)))
</div><div class='output co'>#&gt; (Intercept)           x 
#&gt;  0.01618977  0.01426121 </div><div class='input'>
<span class='co'>## lag length set to: floor(4 * (T / 100)^(2/9))</span>
<span class='co'>## rule of thumb proposed by Hoechle (2007) based on Newey &amp; West (1994)</span>
<span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span>(<span class='fu'>vcovPL</span>(<span class='kw'>m</span>, cluster = <span class='op'>~</span> <span class='kw'>firm</span> <span class='op'>+</span> <span class='kw'>year</span>, lag = <span class='st'>"NW1994"</span>)))
</div><div class='output co'>#&gt; (Intercept)           x 
#&gt;  0.02289115  0.02441980 </div><div class='input'>
<span class='co'>## lag length set to: floor(T^(1/4))</span>
<span class='co'>## rule of thumb based on Newey &amp; West (1987)</span>
<span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span>(<span class='fu'>vcovPL</span>(<span class='kw'>m</span>, cluster = <span class='op'>~</span> <span class='kw'>firm</span> <span class='op'>+</span> <span class='kw'>year</span>, lag = <span class='st'>"NW1987"</span>)))
</div><div class='output co'>#&gt; (Intercept)           x 
#&gt;  0.02436219  0.02816896 </div><div class='input'>
<span class='co'>## the following specifications of cluster/order.by are equivalent</span>
<span class='fu'>vcovPL</span>(<span class='kw'>m</span>, cluster = <span class='op'>~</span> <span class='kw'>firm</span> <span class='op'>+</span> <span class='kw'>year</span>)
</div><div class='output co'>#&gt;              (Intercept)            x
#&gt; (Intercept) 5.935164e-04 2.222292e-05
#&gt; x           2.222292e-05 7.934905e-04</div><div class='input'><span class='fu'>vcovPL</span>(<span class='kw'>m</span>, cluster = <span class='kw'>PetersenCL</span>[, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"firm"</span>, <span class='st'>"year"</span>)])
</div><div class='output co'>#&gt;              (Intercept)            x
#&gt; (Intercept) 5.935164e-04 2.222292e-05
#&gt; x           2.222292e-05 7.934905e-04</div><div class='input'><span class='fu'>vcovPL</span>(<span class='kw'>m</span>, cluster = <span class='op'>~</span> <span class='kw'>firm</span>, order.by = <span class='op'>~</span> <span class='kw'>year</span>)
</div><div class='output co'>#&gt;              (Intercept)            x
#&gt; (Intercept) 5.935164e-04 2.222292e-05
#&gt; x           2.222292e-05 7.934905e-04</div><div class='input'><span class='fu'>vcovPL</span>(<span class='kw'>m</span>, cluster = <span class='kw'>PetersenCL</span><span class='op'>$</span><span class='kw'>firm</span>, order.by = <span class='kw'>PetersenCL</span><span class='op'>$</span><span class='kw'>year</span>)
</div><div class='output co'>#&gt;              (Intercept)            x
#&gt; (Intercept) 5.935164e-04 2.222292e-05
#&gt; x           2.222292e-05 7.934905e-04</div><div class='input'>
<span class='co'>## these are also the same when observations within each</span>
<span class='co'>## cluster are already ordered</span>
<span class='fu'>vcovPL</span>(<span class='kw'>m</span>, cluster = <span class='op'>~</span> <span class='kw'>firm</span>)
</div><div class='output co'>#&gt;              (Intercept)            x
#&gt; (Intercept) 5.935164e-04 2.222292e-05
#&gt; x           2.222292e-05 7.934905e-04</div><div class='input'><span class='fu'>vcovPL</span>(<span class='kw'>m</span>, cluster = <span class='kw'>PetersenCL</span><span class='op'>$</span><span class='kw'>firm</span>)
</div><div class='output co'>#&gt;              (Intercept)            x
#&gt; (Intercept) 5.935164e-04 2.222292e-05
#&gt; x           2.222292e-05 7.934905e-04</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Achim Zeileis, Thomas Lumley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


