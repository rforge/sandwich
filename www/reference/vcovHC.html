<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Heteroskedasticity-Consistent Covariance Matrix Estimation — vcovHC • sandwich</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  

<meta property="og:title" content="Heteroskedasticity-Consistent Covariance Matrix Estimation — vcovHC" />
<meta property="og:description" content="Heteroskedasticity-consistent estimation of the covariance matrix of the
 coefficient estimates in regression models." />
<meta property="og:image" content="http://sandwich.R-Forge.R-project.org/logo.png" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:creator" content="@AchimZeileis" />
<meta name="twitter:site" content="@AchimZeileis" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sandwich</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.0-0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/sandwich.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/jss_2004.html">Econometric Computing with HC and HAC Covariance Matrix Estimators</a>
    </li>
    <li>
      <a href="../articles/jss_2006.html">Object-Oriented Computation of Sandwich Estimators</a>
    </li>
    <li>
      <a href="../articles/jss_2020.html">Various Versatile Variances: An Object-Oriented Implementation of Clustered Covariances in R</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="../contact.html">Contact</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Heteroskedasticity-Consistent Covariance Matrix Estimation</h1>
    
    <div class="hidden name"><code>vcovHC.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Heteroskedasticity-consistent estimation of the covariance matrix of the
 coefficient estimates in regression models.</p>
    </div>

    <pre class="usage"><span class='fu'>vcovHC</span>(<span class='no'>x</span>, <span class='no'>...</span>)

<span class='co'># S3 method for default</span>
<span class='fu'>vcovHC</span>(<span class='no'>x</span>,
  <span class='kw'>type</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"HC3"</span>, <span class='st'>"const"</span>, <span class='st'>"HC"</span>, <span class='st'>"HC0"</span>, <span class='st'>"HC1"</span>, <span class='st'>"HC2"</span>, <span class='st'>"HC4"</span>, <span class='st'>"HC4m"</span>, <span class='st'>"HC5"</span>),
  <span class='kw'>omega</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>sandwich</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>...</span>)

<span class='fu'>meatHC</span>(<span class='no'>x</span>, <span class='kw'>type</span> <span class='kw'>=</span> , <span class='kw'>omega</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>a fitted model object.</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p>a character string specifying the estimation type. For
     details see below.</p></td>
    </tr>
    <tr>
      <th>omega</th>
      <td><p>a vector or a
     function depending on the arguments <code>residuals</code>
     (the working residuals of the model), <code>diaghat</code> (the diagonal 
     of the corresponding hat matrix) and <code>df</code> (the residual degrees of
     freedom). For details see below.</p></td>
    </tr>
    <tr>
      <th>sandwich</th>
      <td><p>logical. Should the sandwich estimator be computed?
    If set to <code>FALSE</code> only the meat matrix is returned.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>arguments passed to <code><a href='sandwich.html'>sandwich</a></code> (in <code>vcovHC</code>)
   and <code><a href='estfun.html'>estfun</a></code> (in <code>meatHC</code>), respectively.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The function <code>meatHC</code> is the real work horse for estimating
  the meat of HC sandwich estimators -- the default <code>vcovHC</code> method
  is a wrapper calling
  <code><a href='sandwich.html'>sandwich</a></code> and <code><a href='bread.html'>bread</a></code>. See Zeileis (2006) for
  more implementation details. The theoretical background, exemplified
  for the linear regression model, is described below and in Zeileis (2004).
  Analogous formulas are employed for other types of models.</p>
<p>When <code>type = "const"</code> constant variances are assumed and
  and <code>vcovHC</code> gives the usual estimate of the covariance matrix of
  the coefficient estimates:</p>
<p>$$\hat \sigma^2 (X^\top X)^{-1}$$</p>
<p>All other methods do not assume constant variances and are suitable in case of
  heteroskedasticity. <code>"HC"</code> (or equivalently <code>"HC0"</code>) gives White's
  estimator, the other estimators are refinements of this. They are all of form</p>  
<p>$$(X^\top X)^{-1} X^\top \Omega X (X^\top X)^{-1}$$</p>
<p>and differ in the choice of Omega. This is in all cases a diagonal matrix whose 
  elements can be either supplied as a vector <code>omega</code> or as a
  a function <code>omega</code> of the residuals, the diagonal elements of the hat matrix and
  the residual degrees of freedom. For White's estimator</p>  
<p><code>omega &lt;- function(residuals, diaghat, df) residuals^2</code></p>  
<p>Instead of specifying the diagonal <code>omega</code> or a function for
  estimating it, the <code>type</code> argument can be used to specify the 
  HC0 to HC5 estimators. If <code>omega</code> is used, <code>type</code> is ignored.</p>  
<p>Long \&amp; Ervin (2000) conduct a simulation study of HC estimators (HC0 to HC3) in
  the linear regression model, recommending to use HC3 which is thus the
  default in <code>vcovHC</code>. Cribari-Neto (2004), Cribari-Neto, Souza, \&amp; Vasconcellos (2007),
  and Cribari-Neto \&amp; Da Silva (2011), respectively, suggest the HC4, HC5, and
  modified HC4m type estimators. All of them are tailored to take into account
  the effect of leverage points in the design matrix. For more details see the references.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A matrix containing the covariance matrix estimate.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Cribari-Neto F. (2004), Asymptotic Inference under Heteroskedasticity
of Unknown Form. <em>Computational Statistics &amp; Data Analysis</em>
<b>45</b>, 215--233.</p>
<p>Cribari-Neto F., Da Silva W.B. (2011), A New Heteroskedasticity-Consistent
Covariance Matrix Estimator for the Linear Regression Model.
<em>Advances in Statistical Analysis</em>, <b>95</b>(2), 129--146.</p>
<p>Cribari-Neto F., Souza T.C., Vasconcellos, K.L.P. (2007), Inference under
Heteroskedasticity and Leveraged Data. <em>Communications in Statistics -- Theory and
Methods</em>, <b>36</b>, 1877--1888. Errata: <b>37</b>, 3329--3330, 2008.</p>
<p>Long J. S., Ervin L. H. (2000), Using Heteroscedasticity Consistent Standard
Errors in the Linear Regression Model. <em>The American Statistician</em>,
<b>54</b>, 217--224.</p>
<p>MacKinnon J. G., White H. (1985), Some Heteroskedasticity-Consistent
Covariance Matrix Estimators with Improved Finite Sample Properties.
<em>Journal of Econometrics</em> <b>29</b>, 305--325.</p>
<p>White H. (1980), A Heteroskedasticity-Consistent Covariance Matrix and
a Direct Test for Heteroskedasticity. <em>Econometrica</em> <b>48</b>,
817--838.</p>
<p>Zeileis A (2004), Econometric Computing with HC and HAC Covariance Matrix
Estimators. <em>Journal of Statistical Software</em>, <b>11</b>(10), 1--17.
URL <a href='http://www.jstatsoft.org/v11/i10/'>http://www.jstatsoft.org/v11/i10/</a>.</p>
<p>Zeileis A (2006), Object-Oriented Computation of Sandwich Estimators.
<em>Journal of Statistical Software</em>, <b>16</b>(9), 1--16.
URL <a href='http://www.jstatsoft.org/v16/i09/'>http://www.jstatsoft.org/v16/i09/</a>.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='https://rdrr.io/r/stats/lm.html'>lm</a></code>, <code><a href='https://rdrr.io/pkg/car/man/hccm.html'>hccm</a></code>,
<code><a href='https://rdrr.io/pkg/lmtest/man/bptest.html'>bptest</a></code>, <code><a href='https://rdrr.io/pkg/car/man/car-defunct.html'>ncv.test</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## generate linear regression relationship</span>
<span class='co'>## with homoskedastic variances</span>
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Trig.html'>sin</a></span>(<span class='fl'>1</span>:<span class='fl'>100</span>)
<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span> + <span class='no'>x</span> + <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='fl'>100</span>)
<span class='co'>## model fit and HC3 covariance</span>
<span class='no'>fm</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span>(<span class='no'>y</span> ~ <span class='no'>x</span>)
<span class='fu'>vcovHC</span>(<span class='no'>fm</span>)</div><div class='output co'>#&gt;              (Intercept)            x
#&gt; (Intercept)  0.013240282 -0.007646095
#&gt; x           -0.007646095  0.024425977</div><div class='input'><span class='co'>## usual covariance matrix</span>
<span class='fu'>vcovHC</span>(<span class='no'>fm</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"const"</span>)</div><div class='output co'>#&gt;              (Intercept)            x
#&gt; (Intercept) 1.301490e-02 3.292563e-05
#&gt; x           3.292563e-05 2.589083e-02</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/stats/vcov.html'>vcov</a></span>(<span class='no'>fm</span>)</div><div class='output co'>#&gt;              (Intercept)            x
#&gt; (Intercept) 1.301490e-02 3.292563e-05
#&gt; x           3.292563e-05 2.589083e-02</div><div class='input'>
<span class='no'>sigma2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/residuals.html'>residuals</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span>(<span class='no'>y</span> ~ <span class='no'>x</span>))^<span class='fl'>2</span>)/<span class='fl'>98</span>
<span class='no'>sigma2</span> * <span class='fu'><a href='https://rdrr.io/r/base/solve.html'>solve</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/crossprod.html'>crossprod</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>(<span class='fl'>1</span>, <span class='no'>x</span>)))</div><div class='output co'>#&gt;                           x
#&gt;   1.301490e-02 3.292563e-05
#&gt; x 3.292563e-05 2.589083e-02</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Achim Zeileis, Thomas Lumley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


